
\section{Catalan characterization}

\input{Chapters/mod-p-characterization/catalan/catalan-traditional-standard-ignore-negatives-centered-colouring-127-rows-mod2-partitioning-include-figure.tex}
In this section we tackle a modular characterization for the Catalan array
$\mathcal{C}$ from a formal point of view. We aim at provide a proof driven
from
\autoref{fig:catalan-traditional-standard-ignore-negatives-centered-colouring-127-rows-mod2-partitioning-triangle},
and in order to accomplish this task we proceed \emph{piecewise}, breaking such
characterization into sections such that each one of them describes an
independent chunk of $\mathcal{C}$.

% inclusion of matrix expansion for C and its inverse.
\input{Chapters/mod-p-characterization/catalan/catalan-traditional-standard-ignore-negatives-centered-colouring-127-rows-mod2-partitioning-include-matrix.tex}

\iffalse
Let $\mathcal{C}_{h}$ a principal $h$-cluster of
the Catalan array, in its traditional definition: We attempt to point out
some properties about $\mathcal{C}_{h+1}$:
\begin{itemize}
    \item a more general pattern, for any $h\in\mathcal{N}$, 
        a coefficient $d_{p^{h}-1,k}$, for $k\in\lbrace0,\ldots,p^{h}-1 \rbrace$, 
        satisfies:
        \begin{displaymath}
            d_{p^{h}-1,k} \equiv_{p} 0
        \end{displaymath}
    \item consider the subcluster $\mathcal{C}_{h}^{(0,p^{h}-1)}$ of 
        $\mathcal{C}_{h}$ obtained by removing antidiagonal $0$ (namely,
        the boundary one, composed by $1$s only) and by removing row $p^{h}-1$.
        By construction, $\mathcal{C}_{h}^{(0,p^{h}-1)}$ is a triangle too, 
        with $p^{h}-2$ coefficients per side. Therefore, $\mathcal{C}_{h+1}$
        is composed on the very top, starting at the root, by a copy of $\mathcal{C}_{h}$,
        while on the bottom there are three triangles:
        \begin{itemize}                
            \item an equilateral triangle $T_{\equiv_{p} 0}^{(h)}$, 
                with $p^{h}-1$ coefficients on each side, such that:
                \begin{displaymath}
                    d_{nk} \in T_{\equiv_{p} 0}^{(h)} \rightarrow d_{nk} \equiv_{p} 0
                \end{displaymath}
                where $n\in\lbrace p^{h},\ldots,p^{h+1}-2\rbrace$ and 
                $k\in\lbrace 0,\ldots, n-p^{h}\rbrace$, in other words
                $k\in\lbrace 0,\ldots, p^{h}(p-1)-2\rbrace$;
            \item a mirror copy of $\mathcal{C}_{h}^{(0,p^{h}-1)}$ respect column orientation,
                defining coefficients $d_{nk}$  
                where $n\in\lbrace p^{h},\ldots,p^{h+1}-2\rbrace$ and 
                $k\in\lbrace 1,\ldots, p^{h}-2\rbrace$;
            \item a segment of coefficients $d_{n, p^{h}-1} \equiv_{p} 0$ 
                where $n\in\lbrace p^{h},\ldots,p^{h+1}-2\rbrace$;
            \item a copy of $\mathcal{C}_{h}^{(0,p^{h}-1)}$,
                defining coefficients $d_{nk}$  
                where $n\in\lbrace p^{h}+1,\ldots,p^{h+1}-2\rbrace$ and 
                $k\in\lbrace p^{h},\ldots, n-1\rbrace$;
        \end{itemize}                
\end{itemize}
\fi

\subsection{Some false starts}

In order to formally proof the modular characterization of array $\mathcal{C}$, 
we begin with an attempt which applies the \emph{Lagrange Inversion Formula}. 
Write the generic element $d_{nk}\in\mathcal{C}$ using the definition:
\begin{displaymath}
    d_{nk} = [t^n] \frac{1-\sqrt{1-4\,t}}{2\,t}\,
        \left(\frac{1-\sqrt{1-4\,t}}{2}\right)^{k}
           = [t^{n+1}] \left(\frac{1-\sqrt{1-4\,t}}{2}\right)^{k+1} 
\end{displaymath}
The version of the \emph{LIF} we'll apply is the following one:
\begin{displaymath}
    \alpha\,\left[z^\alpha\right] A(z)^{\beta} = 
        \beta\,\left[w^{\alpha-\beta}\right]\Phi(w)^{\alpha}
\end{displaymath}
where $\alpha,\beta\in\mathbb{Z}$ and function $A$ relates to function
$\Phi$ according to: 
\begin{displaymath} A(z)=z\,\Phi(A(z)) \end{displaymath}
under the constraint $\Phi(0)\not=0$, otherwise a contraddiction arises
(critical relation is emphasized with $\circeq$ symbol):
\begin{displaymath} 
    z\,\Phi(0) \circeq 0 \rightarrow z\circeq\frac{0}{\Phi(0)} 
\end{displaymath}

\emph{LIF} theorem's ``from right to left'' direction allow us to make 
the following definitions:
\begin{displaymath}
    \Phi(t)=\frac{1-\sqrt{1-4\,t}}{2}\qquad \alpha=k+1\qquad \beta=k-n
\end{displaymath}
Since $\Phi(0)=0$ we cannot apply the theorem directly, so try
a combinatorial interpretation. Observe that:
\begin{displaymath}
    [t^{n+1}] \left(\frac{1-\sqrt{1-4\,t}}{2}\right)^{k+1} 
\end{displaymath}
requires to extract coefficient $n+1$ from the $(k+1)$-fold
convolution of Catalan numbers' generating function, \emph{shifted
by one place}, with itself. Before going on, be careful
to understand what coefficients are introduced; the
following expansion defines a sequence $\lbrace \hat{c}_{i}\rbrace_{i\in\mathbb{N}}$:
\begin{displaymath}
    \frac{1-\sqrt{1-4\,t}}{2} = t + t^{2} + 2 t^{3} + 5 t^{4} 
        + 14 t^{5} + 42 t^{6} + 132 t^{7} + 429 t^{8} + 1430 t^{9} 
        + \mathcal{O}\left(t^{10}\right)
\end{displaymath}
where $\hat{c}_{0}=0$. On the other hand the following one, defines a sequence 
$\lbrace c_{i}\rbrace_{i\in\mathbb{N}}$, the traditional Catalan numbers:
\begin{displaymath}
    \frac{1-\sqrt{1-4\,t}}{2\,t} = 1 + t + 2 t^{2} + 5 t^{3} + 14 t^{4} 
        + 42 t^{5} + 132 t^{6} + 429 t^{7} + 1430 t^{8} + 4862 t^{9} 
        + \mathcal{O}\left(t^{10}\right)
\end{displaymath}
so the relationship $\hat{c}_{j} = c_{j-1}$ holds for any $j\in\mathbb{N}$, 
with boundary condition $c_{-1}=0$. 

After this subtle point, there exists indices $i_{1}, i_{2}, \ldots, i_{k+1}$,
where $i_{j}\in\lbrace0,\ldots,n+1\rbrace$ for each $j\in\lbrace1,\ldots,k+1\rbrace$, 
such that:
\begin{displaymath}
    [t^{n+1}] \left(\frac{1-\sqrt{1-4\,t}}{2}\right)^{k+1} 
        = \sum_{i_{1}+ i_{2}+ \ldots+ i_{k+1}=n+1}{
            \hat{c}_{i_{1}}\,\hat{c}_{i_{2}}\,\ldots\,\hat{c}_{i_{k+1}} }
\end{displaymath}
which is the same as:
\begin{displaymath}
    [t^{n+1}] \left(\frac{1-\sqrt{1-4\,t}}{2}\right)^{k+1} 
        = \sum_{i_{1}+ i_{2}+ \ldots+ i_{k+1}=n+1}{
            c_{i_{1}-1}\,c_{i_{2}-1}\,\ldots\,c_{i_{k+1}-1} }
\end{displaymath}

Since $c_{j}$ is a Catalan coefficient, 
by definition of array $\mathcal{C}$, we observe that:
\begin{displaymath}
    c_{j} = [t^{j}]d(t)= [t^{j}]\frac{1-\sqrt{1-4\,t}}{2\,t}
\end{displaymath}
and since $\mathcal{C}$'s $A$-sequence is:
\begin{displaymath}
    A(t)=\frac{1}{1-t}
\end{displaymath}
each coefficient $c_{j}$ combines as follows:
\begin{displaymath}
    c_{j} = \sum_{k=0}^{j-1}{d_{j-1,k}}
\end{displaymath}
in other words, $c_{j}$ equals the $(j-1)$-row sum, therefore:
\marginpar{another \ac{gf} for the Catalan numbers}
\begin{displaymath}
    c_{j} = [t^{j-1}]\mathcal{C}\,A(t)
          = [t^{j-1}]d(t)\,A(h(t))
          = [t^{j}]h(t)\,A(h(t))
          = [t^{j}]\frac{1-\sqrt{1-4 \, t}}{1+\sqrt{1-4 \, t}}
\end{displaymath}
with boundary condition $c_{0}=1$, which cannot be read from the above
series expansion. Although interesting, this result is again difficult to
handle. Moreover, from the above equation, it is possible to derive
another generating function for the sequence of Catalan numbers:
\marginpar{yet another \ac{gf} for the Catalan numbers}
\begin{displaymath}
    \frac{1-\sqrt{1-4 \, t}}{1+\sqrt{1-4 \, t}}=
    \frac{\left(1-\sqrt{1-4 \, t}\right)^{2}}{4 \, t}=
    \frac{1-2\,t-\sqrt{1-4 \, t}}{2 \, t}
\end{displaymath}

Go back to identity:
\begin{displaymath}
    d_{nk} = \sum_{i_{1}+ i_{2}+ \ldots+ i_{k+1}=n+1}{
            c_{i_{1}-1}\,c_{i_{2}-1}\,\ldots\,c_{i_{k+1}-1} }
\end{displaymath}
and write a Catalan coefficient $c_{j}$ in a different form:
\begin{equation}
    c_{j} = \frac{1}{j+1}{{2j}\choose{j}} 
        = {{2j}\choose{j}} - {{2j}\choose{j+1}}
    \label{eq:catalan:coeff:rewriting}
\end{equation}
% TODO put here the reference to the bibitem.
according to article \emph{Identities induced by Riordan arrays}. This
last equation will play an important role in the following sections, in
particular when reasoning about convolutions will be hard, it will 
help to close proofs.

\subsection{On the very first column of $\mathcal{C}_{\equiv_{2}}$}

Use \autoref{eq:catalan:coeff:rewriting}
and set a congruence relation, modulo $2$: write $j$ in base $2$, 
so there exists $k\in\mathbb{N}$ such that 
$j=j_{0} + j_{1}\,2 + j_{2}\,2^{2} + \ldots + j_{k}\,2^{k}$, where
$j_{r}\in\lbrace0,1\rbrace$, for each $r\in\lbrace0,\ldots,k\rbrace$. 
% now start distinguishing $j$ by cases: if even..., if odd...
In order to apply Lucas theorem, we proceed by cases on $j$'s parity:
\begin{itemize}
    \item let $j=2\alpha$, for some $\alpha\in\mathbb{N}$, so $j_{0}=0$,
        which make vanish the minuend:
        \begin{displaymath}
            {{2j}\choose{j+1}}
            \equiv_{2} {{0}\choose{1}}{{0}\choose{j_{1}}}{{j_{1}}\choose{j_{2}}}
                \ldots{{j_{k-1}}\choose{j_{k}}}{{j_{k}}\choose{0}}\equiv_{2}0
        \end{displaymath}
        so:
        \begin{displaymath}
            c_{j}\equiv_{2}{{2j}\choose{j}}
            \equiv_{2} {{0}\choose{0}}{{0}\choose{j_{1}}}{{j_{1}}\choose{j_{2}}}
                \ldots{{j_{k-1}}\choose{j_{k}}}{{j_{k}}\choose{0}}\equiv_{2}0
        \end{displaymath}
        \marginpar{$c_{0}$ is the only odd Catalan number among those 
            $\lbrace c_{j}\rbrace_{j\in\mathbb{N}}$ for which $j$ is even}
        A boundary case pops out when $\alpha=0$ where $j$ has to be written as 
        $j=0 + 0\cdot2 + 0\cdot2^{2} + \ldots + 0\cdot2^{k}$, therefore:
        \begin{displaymath}
            c_{0}\equiv_{2}{{0}\choose{0}}
            \equiv_{2} {{0}\choose{0}}{{0}\choose{0}}{{0}\choose{0}}
                \ldots{{0}\choose{0}}{{0}\choose{0}}\equiv_{2}1
        \end{displaymath}
        this is indeed the only case where $c_{2\alpha} \equiv_{2}1$,
        as the following alternative proof confirms:
        \begin{proof}
            Assume not, hence there exists $\hat{\alpha}\in\mathbb{N}$, greater than $0$,
            such that $c_{2\hat{\alpha}} \equiv_{2}1$. So for ${{0}\choose{j_{1}}}$
            be not zero then $j_{1}=0$; in turn, this constraint requires a new one, namely
            for ${{0}\choose{j_{2}}}$ be not zero then $j_{2}=0$; 
            in turn, this constraint requires a new one, namely
            for ${{0}\choose{j_{3}}}$ be not zero then $j_{3}=0$; 
            in turn, this constraint requires a new one, namely\ldots
            for ${{0}\choose{j_{k}}}$ be not zero then $j_{k}=0$.
            Therefore $j=0$, which contradicts the hypothesis $\alpha>0$. So,
            for even $j > 0$, coefficient $c_{j}\equiv_{2}0$, as required.
        \end{proof}

    \item let $j=2\alpha+1$, for some $\alpha\in\mathbb{N}$, so $j_{0}=1$,
        which make vanish the augend:
        \begin{displaymath}
            {{2j}\choose{j}}
            \equiv_{2} {{0}\choose{1}}{{1}\choose{j_{1}}}{{j_{1}}\choose{j_{2}}}
                \ldots{{j_{k-1}}\choose{j_{k}}}{{j_{k}}\choose{0}}\equiv_{2}0
        \end{displaymath}
        so:
        \begin{displaymath}
            c_{j}\equiv_{2}-{{2j}\choose{j+1}}
            %\equiv_{2} {{0}\choose{0}}{{0}\choose{j_{1}}}{{j_{1}}\choose{j_{2}}}
                %\ldots{{j_{k-1}}\choose{j_{k}}}{{j_{k}}\choose{0}}\equiv_{2}0
        \end{displaymath}
        observe that $(-1)^{-1}\mod2$, the multiplicative inverse of $-1$, equals $1$
        since $(-1)\cdot 1 \equiv_{2}1$, therefore we can multiply both members by
        $(-1)^{-1}\mod2$ to get:
        \begin{displaymath}
            c_{j}\equiv_{2}{{2j}\choose{j+1}}
            %\equiv_{2} {{0}\choose{0}}{{0}\choose{j_{1}}}{{j_{1}}\choose{j_{2}}}
                %\ldots{{j_{k-1}}\choose{j_{k}}}{{j_{k}}\choose{0}}\equiv_{2}0
        \end{displaymath}

        Careful handling is necessary for the term $j+1$: 
        since $j$ is odd by hypothesis, increasing it could yield a chain of carries.
        So, handling $j+1$ in a generic way, we write
        $j$ in base $2$ in its most general form, putting evidence on coefficients:
        \begin{displaymath}
            j=\left(\underbrace{1,1,\ldots,1}_{\beta},0,j_{\beta+1},\ldots,j_{\beta+\gamma}\right)_{2}
        \end{displaymath}
        where $\beta,\gamma\in\mathbb{N}$ such that $\beta>0$ and $\beta+\gamma=k$. 
        Increment by $1$:
        \begin{displaymath}
            j+1=\left(\underbrace{0,0,\ldots,0}_{\beta},1,j_{\beta+1},\ldots,j_{\beta+\gamma}%,j_{\beta+\gamma+1}
                \right)_{2}
        \end{displaymath}
        so the congruence relation gets the following shape:
        \begin{displaymath}
            c_{j}\equiv_{2}{{2j}\choose{j+1}}
                \equiv_{2} \underbrace{{{0}\choose{0}}{{1}\choose{0}}
                {{1}\choose{0}}\ldots{{1}\choose{0}}}_{\beta} 
                    {{1}\choose{1}}{{0}\choose{j_{\beta+1}}}{{j_{\beta+1}}\choose{j_{\beta+2}}}
                    \ldots{{j_{\beta+\gamma-1}}\choose{j_{\beta+\gamma}}}{{j_{\beta+\gamma}}\choose{0}}%{\beta+\gamma+1}}
        \end{displaymath}
        a simplification yield:
        \begin{displaymath}
            c_{j}\equiv_{2} {{0}\choose{j_{\beta+1}}}
                {{j_{\beta+1}}\choose{j_{\beta+2}}}
                    \ldots{{j_{\beta+\gamma-1}}\choose{j_{\beta+\gamma}}}
        \end{displaymath}
        so $c_{j}\equiv_{2} 1$ if coefficients 
            $j_{\beta+1}, \ldots, j_{\beta+\gamma-1},j_{\beta+\gamma}$
        are $0$ them all, which implies that:
        \begin{displaymath}
            j=\left(\underbrace{1,1,\ldots,1}_{\beta},\underbrace{0,0,\ldots,0}_{k-\beta+1}\right)_{2}
        \end{displaymath}

        \marginpar{$c_{2^{\alpha}-1} \equiv_{2} 1$\\Otherwise, for any $j$ odd, 
            $c_{j} \equiv_{2} 0$} 
        in other words $j = 2^{\beta+1}-1$. As boundary case, to handle $c_{1}$ correctly 
        (the above result doesn't cover it because $\beta>0$) observe:
        \begin{displaymath}
            c_{1}\equiv_{2} {{2}\choose{2}}\equiv_{2} {{0}\choose{0}}{{1}\choose{1}}\equiv_{2}1
        \end{displaymath}
\end{itemize}

\marginpar{using the ``classic'' closed formula on $c_{2\alpha+1}$ doesn't
    close the above proof}
It is interesting to observe that if we use the ``traditional'' characterization
of a Catalan coefficient $c_{j}$:
\begin{displaymath}
    (j+1)\,c_{j} = {{2j}\choose{j}} 
\end{displaymath}
where $j=2\alpha+1$, would've been hard to handle, because:
\begin{displaymath}
    2(\alpha+1)\,c_{j}\equiv_{2} {{0}\choose{1}}{{1}\choose{j_{1}}}
            \ldots{{j_{k-1}}\choose{j_{k}}}
\end{displaymath}
reduces to $0\equiv_{2}0$ identity, giving no opportunity to derive some
properties about coefficient $c_{j}$.





\subsection{Some open questions}
% TODO ask how show the modular characterization of the inverse of C, formally
\input{Chapters/mod-p-characterization/catalan/catalan-traditional-inverse-ignore-negatives-centered-colouring-127-rows-mod2-partitioning-include-figure.tex}
What about a formal proof for the modular characterization of $\mathcal{C}_{\equiv_{2}}^{-1}$, reported in 
\autoref{fig:catalan-traditional-inverse-ignore-negatives-centered-colouring-127-rows-mod2-partitioning-triangle}?

And in general, how generalize to an arbitrary prime $p$?
