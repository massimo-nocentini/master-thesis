

\section{Group operations, revisited}

In this section we revise \emph{Riordan group} concepts described in
\autoref{subsection:back:to:the:basics:riordan:group}, looking at them under
the light of $h$-characterization. In particular, we show how a Riordan arrays
written using the proposed characterization, allows us to build new arrays
respect to group operation $\cdot$ and to find their inverses.

\subsection{Inverting an array}

Let $\mathcal{R}\left(d(t),h(t)\right)$ be a Riordan array and let 
$\mathcal{R}_{h(t)}\left(g(h(t)),h(t)\right)$ its $h$-characterization, for some
function $g$. %in the variable $h(t)$. 
 
Using rules for inversion in the Riordan group, 
\marginpar{using $\mathcal{R}_{h(t)}$ 
polymorphically as an array, remind \autoref{par:h:characterization:is:an:array:polymorphism}}
proceed as follow:
\begin{displaymath}
    \begin{split}
        \mathcal{R}_{h(t)}^{-1}\left(\frac{1}{g(h(\hat{h}(t)))},\hat{h}(t)\right)&=
        \left[\mathcal{R}^{-1}\left(\left.\frac{1}{g(h(y))},y\right) \right| y = \hat{h}(t) \right]\\
        &= \mathcal{R}_{\hat{h}(t)}^{-1}\left(k(\hat{h}(t)),\hat{h}(t)\right)
    \end{split}
\end{displaymath}
where function $k$ is defined as $k(y)=\frac{1}{g(h(y))}$, 
therefore we got a new array $\mathcal{T}_{\hat{h}(t)}$ which is the $\hat{h}$-characterization
of $\mathcal{R}_{h(t)}^{-1}$ and, as the same time, of $\mathcal{R}^{-1}$.
\marginpar{again, $\hat{h}(t)$ plays the role of a \emph{variable},
so don't be tempted to say $h(\hat{h}(t))=t$ as in the normal course of things \ldots}
\\\\
For the sake of clarity we apply the previous derivation to build the inverse of $\mathcal{F}$,
the Fibonacci array.  To set the stage we need function $h$, take it from the definition:
\begin{displaymath}
    \begin{split}
        h(t)&=\frac{1-\sqrt{1-4t}}{2}\\
    \end{split}
\end{displaymath}
we need also function $g$, take it from the $h$-characterization $\mathcal{F}_{h(t)}$:
\begin{displaymath}
    \left[g(y)=\left.\frac{1}{1-y+2y^3-y^4} \right| y=h(t)\right]
\end{displaymath}
we're ready to apply:
\begin{displaymath}
    \left[\mathcal{F}^{-1}\left.\left(1-y-y^2,y\right) \right| y = \hat{h}(t) \right]=
    \mathcal{F}_{\hat{h}(t)}^{-1}\left(1-\hat{h}(t)-\hat{h}(t)^2,\hat{h}(t)\right)
\end{displaymath}
where function $\hat{h}$ is the compositional inverse of function $h$. Observe
that $1-y-y^2$ in the left array under variable constraint $y=\hat{h}(t)$, is
obtained by evaluating $\frac{1}{g(h(y))}$, considering $y$ as a variable:
using this abstraction, function $\hat{h}(t)$ cannot be used
\emph{functionally}, otherwise $g(h(\hat{h}(k)))=g(k)$, where $k=h(t)$
according to constraint under $g$ is defined. If that would be the case, it
yields a factorization in $h(t)$, not in $\hat{h}(t)$, as we would like to
have.

If the explicit definition for $\mathcal{F}^{-1}$ is desired, just plug $\hat{h}(t)=t-t^2$:
\begin{displaymath}
    \left(\mathcal{F}_{\hat{h}(t)}^{-1}\right)^{\stackrel{\hat{h}(t)}{\rightarrow}} =
        \mathcal{F}^{-1}\left(1-t+2t^3-t^4,t-t^2\right)
\end{displaymath}

\subsection{Multiplying two arrays}

Finally, let us tackle the product of two Riordan arrays. 
Multiplication, the action of the Riordan group, between two elements 
$\mathcal{A}(d_{\mathcal{A}}(t), h_{\mathcal{A}}(t))$ and 
$\mathcal{B}(d_{\mathcal{B}}(t), h_{\mathcal{B}}(t))$ belonging to the group, is defined as:
\begin{displaymath}
    \mathcal{A}\mathcal{B} = \left(d_{\mathcal{A}}(t)d_{\mathcal{B}}(h_{\mathcal{A}}(t)),
        h_{\mathcal{B}}(h_{\mathcal{A}}(t))\right)
\end{displaymath}
Consider the $h_{\mathcal{A}}$-characterization of $\mathcal{A}$:
\begin{displaymath}
    \mathcal{A}_{h_\mathcal{A}(t)} \left(\gamma(h_{\mathcal{A}}(t)), h_{\mathcal{A}}(t)  \right)
\end{displaymath}
for some function $\gamma$, and the $h_{\mathcal{B}}$-characterization of $\mathcal{B}$:
\begin{displaymath}
    \mathcal{B}_{h_\mathcal{B}(t)} \left(\eta(h_{\mathcal{B}}(t)), h_{\mathcal{B}}(t)  \right)
\end{displaymath}
for some function $\eta$, respectively. Apply now the multiplication rule:
\begin{displaymath}
    \begin{split}
        & \left(\gamma(h_{\mathcal{A}}(t)), h_{\mathcal{A}}(t)  \right)
            \left(\eta(h_{\mathcal{B}}(t)), h_{\mathcal{B}}(t)  \right) \\
        &=\left[\left.\left(\gamma(y), y  \right)
            \left(\eta(h_{\mathcal{B}}(t)), h_{\mathcal{B}}(t)  \right) \right| y=h_{\mathcal{A}}(t) \right]\\
        &=\left[\left.\left(\gamma(y)\eta(h_{\mathcal{B}}(y)), h_{\mathcal{B}}(y)  \right) \right|
             y=h_{\mathcal{A}}(t) \right]\\
    \end{split}
\end{displaymath}
Stop here, it's enough to build the $h_{\mathcal{A}}$-characterization 
of the product $\mathcal{A}\mathcal{B}$:
\begin{displaymath}
        \left[\left.\left(\Omega(y), h_{\mathcal{B}}(y)  \right) \right| y=h_{\mathcal{A}}(t) \right] 
        =\big(\mathcal{A}\mathcal{B}\big)_{h_{\mathcal{A}}(t)}\left(
            \Omega(h_{\mathcal{A}}(t)), h_{\mathcal{B}}(h_{\mathcal{A}}(t))  \right)
\end{displaymath}
where $\left[\left.\Omega(y)= \gamma(y)\eta(h_{\mathcal{B}}(y))\right| y=h_{\mathcal{A}}(t) \right]$. 
\\\\
Nonetheless, 
\marginpar{The following can be skipped on a first reading}
from were we stopped, it's possible to factor $\mathcal{A}\mathcal{B}$ respect to $h_{\mathcal{B}}(t)$ in
a similar way, this time abstracting over $h_{\mathcal{B}}(y)$, remembering to track $y=h_{\mathcal{A}}(t)$:
\begin{displaymath}
    \begin{split}
        &\left[\left.\left(\gamma(y)\eta(h_{\mathcal{B}}(y)), h_{\mathcal{B}}(y)  \right) \right|
             y=h_{\mathcal{A}}(t) \right]\\
        &=\left.\left[\left.\left(\gamma(\hat{h}_{\mathcal{B}}(k))\eta(k), k  \right) \right|
             k=h_{\mathcal{B}}(y) \right]\right|_{y=h_{\mathcal{A}}(t)}\\
        &=\left.\left[\left.\left(\Theta(k), k  \right) \right| k=h_{\mathcal{B}}(y) \right]\right|_{y=h_{\mathcal{A}}(t)}\\
        &=\left.\big(\mathcal{A}\mathcal{B}\big)_{h_{\mathcal{B}}(y)}\left(
            \Theta(h_{\mathcal{B}}(y)), h_{\mathcal{B}}(y)  \right)\right|_{y=h_{\mathcal{A}}(t)}
    \end{split}
\end{displaymath}
\marginpar{in order to stop tracking $y=h_{\mathcal{A}}(t)$, we should write $(\Theta(k), k)$,
    where $k$ solves
    $h_{\mathcal{B}}(\hat{h}_{\mathcal{A}}(\hat{h}_{\mathcal{B}}(k)))=h_{\mathcal{B}}(t)$,
    but it doesn't supply an explicit variable substitution}
where $\left.\left[\left.\Theta(k)=\gamma(\hat{h}_{\mathcal{B}}(k))\eta(k) \right| 
    k=h_{\mathcal{B}}(y) \right]\right|_{y=h_{\mathcal{A}}(t)}$.

Observe that for the latter factorization, it is necessary to compute function $\hat{h}_{\mathcal{B}}$, 
the compositional inverse of function $h_{\mathcal{B}}$.
\\\\
For the sake of clarity we apply the previous derivation to the product $\mathcal{P}\mathcal{F}$, namely
we'll multiply Pascal and Fibonacci arrays, \emph{in the given order}, providing 
both $\big(\mathcal{P}\mathcal{F}\big)_{h_{\mathcal{P}}(t)}$ 
and $\left.\big(\mathcal{P}\mathcal{F}\big)_{h_{\mathcal{F}}(y)}\right|_{y=h_{\mathcal{P}}(t)}$.

Recall $\mathcal{P}$ and $\mathcal{F}$ $h$-characterizations, they are respectively:
\begin{displaymath}
    \begin{split}
        &\mathcal{P}_{h_{\mathcal{P}}(t)}\left( 1+h_{\mathcal{P}}(t), h_{\mathcal{P}}(t) \right)
            \text{ where } h_{\mathcal{P}}(t) = \frac{t}{1-t}\\
        &\mathcal{F}_{h_{\mathcal{F}}(t)}\left( \frac{1}{1-h_{\mathcal{F}}(t)+
            2h_{\mathcal{F}}(t)^3-h_{\mathcal{F}}(t)^4}, h_{\mathcal{F}}(t) \right)
                \text{ where } h_{\mathcal{F}}(t) = \frac{1-\sqrt{1-4t}}{2}\\
    \end{split}
\end{displaymath}
and recognize the following functions under variable constraint (in the following, $y$
is a ``local'' variable, \emph{it's not shared} among the two definitions):
\begin{displaymath}
    \begin{split}
        &\left.\left[\gamma(y) = 1+y \right| y=h_{\mathcal{P}}(t) \right]\\
        &\left.\left[\eta(y) = \frac{1}{1-y+2y^3-y^4} \right| y=h_{\mathcal{F}}(t) \right]\\
    \end{split}
\end{displaymath}

Toward $\big(\mathcal{P}\mathcal{F}\big)_{h_{\mathcal{P}}(t)}$, compute $\Omega$ function:
\begin{displaymath}
    \left.\left[\Omega(y)= \gamma(y)\eta(h_{\mathcal{F}}(y))\right| y=h_{\mathcal{P}}(t) \right]
        = \left.\left[\Omega(y)= \frac{1+y}{1-y-y^2}\right| y=h_{\mathcal{P}}(t) \right]
\end{displaymath}
\marginpar{$\big(\mathcal{P}\mathcal{F}\big)_{h_{\mathcal{P}}(t)}$}
therefore answer the first question:
\begin{displaymath}
    \big(\mathcal{P}\mathcal{F}\big)_{h_{\mathcal{P}}(t)} \left(\frac{1+
        h_{\mathcal{P}}(t)}{1-h_{\mathcal{P}}(t)-h_{\mathcal{P}}(t)^2}, \frac{1-\sqrt{1-4h_{\mathcal{P}}(t)}}{2} \right)
\end{displaymath}

\marginpar{$\left.\big(\mathcal{P}\mathcal{F}\big)_{h_{\mathcal{F}}(y)}\right|_{y=h_{\mathcal{P}}(t)}$}
Toward $\left.\big(\mathcal{P}\mathcal{F}\big)_{h_{\mathcal{F}}(y)}\right|_{y=h_{\mathcal{P}}(t)}$, compute $\Theta$ function:

\begin{displaymath}
    \begin{split}
        &\left.\left[\left.\Theta(k)=\gamma(\hat{h}_{\mathcal{F}}(k))\eta(k) \right| k=h_{\mathcal{F}}(y) \right]\right|_{y=h_{\mathcal{P}}(t)}\\
        &= \left.\left[\left.\Theta(k)=\frac{1+k-k^2}{1-k+ 2k^3 - k^4} \right| k=h_{\mathcal{F}}(y) \right]\right|_{y=h_{\mathcal{P}}(t)}\\
    \end{split}
\end{displaymath}
where $\hat{h}_{\mathcal{F}}(y)=y-y^2$, therefore answer the second question:
\begin{displaymath}
    \left.\big(\mathcal{P}\mathcal{F}\big)_{h_{\mathcal{F}}(y)} \left(
        \frac{1+h_{\mathcal{F}}(y)-h_{\mathcal{F}}(y)^2}{1-h_{\mathcal{F}}(y)+ 2h_{\mathcal{F}}(y)^3 - h_{\mathcal{F}}(y)^4} ,
        h_{\mathcal{F}}(y) \right)\right|_{y=h_{\mathcal{P}}(t)}
\end{displaymath}

\marginpar{check substituting functions $h_{\mathcal{P}}$ and $h_{\mathcal{F}}$}
Little check plugging in function $h_{\mathcal{P}}(t)$:
\begin{displaymath}
    \left(\big(\mathcal{P}\mathcal{F}\big)_{h_{\mathcal{P}}(t)}\right)^{\stackrel{h_{\mathcal{P}}(t)}{\rightarrow}}
        = \big(\mathcal{P}\mathcal{F}\big)\left(\frac{1-t}{1-3t+t^2}, \frac{1}{2}-\frac{1}{2}\sqrt{\frac{1-5t}{1-t}} \right)
\end{displaymath}
on the other hand, plugging in function $h_{\mathcal{F}}(y)$, where $y=h_{\mathcal{P}}(t)$:
\begin{displaymath}
    \left.\left(\big(\mathcal{P}\mathcal{F}\big)_{h_{\mathcal{F}}(y)}\right)^{\stackrel{h_{\mathcal{F}}(y)}{\rightarrow}}\right|_{y=h_{\mathcal{P}}(t)}
        = \left.\big(\mathcal{P}\mathcal{F}\big)\left(\frac{1+y}{1-y-y^2}, \frac{1-\sqrt{1-4y}}{2} \right)\right|_{y=h_{\mathcal{P}}(t)}
\end{displaymath}
